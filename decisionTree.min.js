(function(p){jQuery.fn.decisionTree=function(B,i){this.each(function(){var k,q,s,t,e,l,f,g,u,r,j,m,h,v,w,x,n,y,z,A;k=p(this);i=i||{};q=i.id||Math.floor(1E3*Math.random());s=i.name||"decision-tree["+q+"]";t=i.label||"- Select";e=[];l={};f=i.decisions||{};g={};r=function(a,b){var c;b&&(a.parent=b);if(a.options)j(a);else if("undefined"!==typeof a.value)h(a.value);else if(a.factor)g[a.parent]=a.factor,h();else if(a.questions&&a.questions.length){for(c=1;c<a.questions.length;c+=1)a.questions[c-1].next=
a.questions[c];j(a.questions[0])}else h()};j=function(a){var b;e.push(a);n(a)?(b=f[a.key])&&(l[a.key]||!a.label)?m(a,b):(a.$select=z(a),l[a.key]=a.$select,a.$select.bind("change",w),b&&(a.options[b]&&n(a.options[b]))&&(a.$select.val(b),m(a,b))):a.next?j(a.next):h()};m=function(a,b){var c;f[a.key]=b;a.$select&&(a.$select.addClass("answered"),a.$select.find("option.default").attr("disabled","disabled"));(c=a.options[b]||a.options["default"])?"number"===typeof c?h(c):r(c,a.key):h(A(a.options))};h=function(a){"undefined"!==
typeof a&&(u=a);for(a=e.length-1;0<=a;a-=1)if(e[a]&&e[a].next&&!y(e[a].next)){j(e[a].next);return}v(u)};v=function(a){for(var b in g)g.hasOwnProperty(b)&&(a*=g[b]);a={value:a,factors:g,decisions:f};setTimeout(function(){k.trigger("decisionTree.complete",a)},0)};w=function(){var a,b;a=p(this);b=a.data("decision-tree-question");f[b.key]&&x(b);m(b,a.val())};x=function(a){var b,c,d;for(b in e)e.hasOwnProperty(b)&&(c=e[b],d?(delete e[b],c.$select&&(c.$select.remove(),delete c.$select,delete l[c.key])):
d=a===c,d&&delete g[c.key]);k.trigger("decisionTree.incomplete")};n=function(a){var b;if(a.requirements)for(b in a=a.requirements,a)if(a.hasOwnProperty(b))if("string"===typeof a[b]){if(f[b]!==a[b])return!1}else if(0>a[b].indexOf(f[b]))return!1;return!0};y=function(a){return 0<=e.indexOf(a)};z=function(a){var b,c,d;b=p('<select id="'+("decision-tree-"+q+"-question-"+a.key)+'" name="'+s+"["+a.key+']" class="decision-tree-question"><option class="default">'+t+" "+a.label+"</option></select>");for(c in a.options)a.options.hasOwnProperty(c)&&
n(a.options[c])&&(d=a.options[c],b.append('<option value="'+c+'">'+(d.label||d)+"</option>"));return b.data("decision-tree-question",a).appendTo(k).hide().fadeIn()};A=function(a){var b,c,d;d=c=0;for(b in a)a.hasOwnProperty(b)&&"number"===typeof a[b]&&(c+=a[b],d+=1);return d?c/d:null};r(B)});return this}})(jQuery);
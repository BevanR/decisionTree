(function(n){jQuery.fn.decisionTree=function(B,h){this.each(function(){var j,p,s,t,d,k,e,f,u,q,i,l,g,v,w,x,m,y,z,A;j=n(this);h=h||{};p=h.id||Math.floor(1E3*Math.random());s=h.name||"decision-tree["+p+"]";t=h.label||"- Select";d=[];k={};e=h.decisions||{};f={};q=function(a,b){var c;b&&(a.parent=b);if(a.options)i(a);else if("undefined"!==typeof a.value)g(a.value);else if(a.factor)f[a.parent]=a.factor,g();else if(a.questions&&a.questions.length){for(c=1;c<a.questions.length;c+=1)a.questions[c-1].next=
a.questions[c];i(a.questions[0])}else g()};i=function(a){var b;d.push(a);m(a)?(b=e[a.key])&&(k[a.key]||!a.label)?l(a,b):(a.$select=z(a),k[a.key]=a.$select,a.$select.bind("change",w),b&&(a.options[b]&&m(a.options[b]))&&(a.$select.val(b),l(a,b))):a.next?i(a.next):g()};l=function(a,b){var c;e[a.key]=b;a.$select&&(a.$select.addClass("answered"),a.$select.find("option.default").attr("disabled","disabled"));(c=a.options[b]||a.options["default"])?"number"===typeof c?g(c):q(c,a.key):g(A(a.options))};g=function(a){"undefined"!==
typeof a&&(u=a);for(a=d.length-1;0<=a;a-=1)if(d[a]&&d[a].next&&!y(d[a].next)){i(d[a].next);return}v(u)};v=function(a){for(var b in f)f.hasOwnProperty(b)&&(a*=f[b]);a={value:a,factors:f,decisions:e};setTimeout(function(){j.trigger("decisionTree.complete",a)},0)};w=function(){var a,b;a=n(this);b=a.data("decision-tree-question");e[b.key]&&x(b);l(b,a.val())};x=function(a){var b,c,r;for(b in d)d.hasOwnProperty(b)&&(c=d[b],r?(delete d[b],c.$select&&(c.$select.remove(),delete c.$select,delete k[c.key])):
r=a===c,r&&delete f[c.key]);j.trigger("decisionTree.incomplete")};m=function(a){var b;if(a.requirements)for(b in a=a.requirements,a)if(a.hasOwnProperty(b))if("string"===typeof a[b]){if(e[b]!==a[b])return!1}else if(0>a[b].indexOf(e[b]))return!1;return!0};y=function(a){return 0<=d.indexOf(a)};z=function(a){var b,c,d;b=n('<select id="'+("decision-tree-"+p+"-question-"+a.key)+'" name="'+s+"["+a.key+']" class="decision-tree-question"><option class="default">'+t+" "+a.label+"</option></select>");for(c in a.options)a.options.hasOwnProperty(c)&&
m(a.options[c])&&(d=a.options[c],b.append('<option value="'+c+'">'+(d.label||d)+"</option>"));return b.data("decision-tree-question",a).appendTo(j).hide().fadeIn()};A=function(a){var b,c,d;d=c=0;for(b in a)a.hasOwnProperty(b)&&"number"===typeof a[b]&&(c+=a[b],d+=1);return c/d};q(B)});return this}})(jQuery);